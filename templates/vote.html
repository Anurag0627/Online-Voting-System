{% extends "base.html" %}
{% block content %}

<style>
.vote-table {
    width: 100%;
    border-collapse: collapse;
    background: #1e293b;
    color: white;
    border-radius: 12px;
    overflow: hidden;
    margin-top: 25px;
}

.vote-table th {
    background: #0ea5e9;
    color: black;
    padding: 14px;
    text-align: center;
    font-size: 15px;
}

.vote-table td {
    padding: 14px;
    text-align: center;
    border-bottom: 1px solid #334155;
    vertical-align: middle;
}

.vote-table tr:hover {
    background: #334155;
}

.vote-btn {
    padding: 8px 16px;
    border: none;
    background: #38bdf8;
    color: black;
    border-radius: 8px;
    transition: 0.25s;
    font-weight: bold;
}
.vote-btn:hover {
    background: #0ea5e9;
    transform: scale(1.05);
}

/* Popup Styling */
#popupBox {
    display:none;
    position:fixed;
    top:30%;
    left:50%;
    transform:translate(-50%, -30%);
    background:#1e293b;
    padding:25px 35px;
    border-radius:12px;
    border:2px solid #38bdf8;
    text-align:center;
    box-shadow:0 4px 20px rgba(0,0,0,0.6);
    z-index: 1000;
}
</style>



<h2 style="animation: fadeIn 1s;">ðŸ—³ Cast Your Vote</h2>

{% if candidates %}
<table class="vote-table">
    <thead>
        <tr>
            <th style="width:10%;">ID</th>
            <th style="width:35%;">Candidate Name</th>
            <th style="width:35%;">Position</th>
            <th style="width:20%;">Vote</th>
        </tr>
    </thead>

    <tbody>
        {% for c in candidates %}
        <tr>
            <td>{{ c.id }}</td>
            <td>{{ c.name }}</td>
            <td>{{ c.position }}</td>
            <td>
                <button class="vote-btn" onclick="submitVote({{ c.id }})">
                    Vote
                </button>
            </td>
        </tr>
        {% endfor %}
    </tbody>

</table>
{% else %}
<p>No candidates available.</p>
{% endif %}


<!-- Popup -->
<div id="popupBox">
    <h4 id="popupMsg"></h4>
    <button class="vote-btn mt-3" onclick="closePopup()">OK</button>
</div>


<script>
function submitVote(candidateId) {

    const userId = localStorage.getItem("user_id");

    if (!userId) {
        showPopup("You must login first!");
        return;
    }

    fetch("/vote", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
            user_id: userId,
            candidate_id: candidateId
        })
    })
    .then(res => res.json())
    .then(resp => {
        showPopup(resp.message || resp.error);
    });
}

function showPopup(msg) {
    document.getElementById("popupMsg").innerText = msg;
    document.getElementById("popupBox").style.display = "block";
}

function closePopup() {
    document.getElementById("popupBox").style.display = "none";
}
</script>

{% endblock %}
